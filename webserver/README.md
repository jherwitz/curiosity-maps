# Webserver 

This directory encapsualtes the webserver component of curiosity-maps, which is repsonsible for rendering 
processed image and location data. The webserver is built on the [Sinatra](http://www.sinatrarb.com/) stack
and makes use of the [Google Maps](https://developers.google.com/maps/documentation/javascript/) and 
[Slick](http://kenwheeler.github.io/slick/) libraries for rendering. The map tiles and some associated code 
were generated by [MapTiler](http://www.maptiler.org/) using USGS maps.

## Usage

This section assumes that database has been populated as detailed in `crawl/README.md`,
and that map tiles have been uploaded to an accessible location (currently hardcoded to S3).

First install the necessary gems - sinatra and mysql are required. 
You'll also need to aquire a Google Maps API key if you don't have one. 

Start the server by running main.rb:

`ruby main.rb <JDBC> <DB_USER> <DB_PASS> <GMAPS_API_KEY> -p <PORT_NUMBER> -e production`

*XXX: Remember to include the `-e production` Sinatra argument if you want to accept external requests!*

Example server invocation:

`sudo nohup ruby main.rb <JDBC> <DB_USER> <DB_PASS> <GMAPS_API_KEY> -p 80 -e production >> ~/logs/sinatra.log 2>&1 &`

mv sinatra.log sinatra.log.$(date +%s)

## Location Estimation

TODO: Describe how we convert db to lattitude and longitude.

## Resources

- [Ruby MySql connector](https://rubygems.org/gems/mysql)
- [Google Maps API key generation](https://developers.google.com/maps/documentation/javascript/tutorial#api_key)
- [Google Maps polylines](https://developers.google.com/maps/documentation/javascript/examples/polyline-simple)
- [Custom Google Map type](https://developers.google.com/maps/documentation/javascript/examples/maptype-image)
- [Google Maps Marker API](https://developers.google.com/maps/documentation/javascript/reference#Marker)
- [USGS MSL Landing Site](http://astrogeology.usgs.gov/maps/mars-science-laboratory-landing-site-selection)
- [USGS Mars FTP listing](http://webgis.wr.usgs.gov/pigwad/down/mars_dl.htm)
- [Embedded Ruby on Wikipedia](http://en.wikipedia.org/wiki/ERuby)
